<!doctype html>
<html lang="sv">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>The CUBE — prototyp (visuellt finjusterad)</title>
<style>
  :root{
    --bg:#e7e7e7; /* match referens ljusgrå bakgrund */
    --panel:#ffffff;
    --muted:#707070;
    --accent:#1f7aef;
    --light-shadow: rgba(0,0,0,0.06);
  }
  html,body{height:100%;margin:0;background:var(--bg);color:#222;font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,Arial;}
  .page{ max-width:1050px; margin:22px auto; padding:0 18px; box-sizing:border-box; }
  .stage{ margin:0 auto; width:760px; position:relative; }

  /* Player card: match sedan-lik bottenpanel */
  .player-card{
    width:720px;
    background:var(--panel);
    border-radius:12px;
    border:1px solid rgba(0,0,0,0.36);
    box-shadow: 0 2px 0 rgba(0,0,0,0.12);
    overflow:visible;
    margin:18px auto;
  }

  /* Reader area */
  .reader-wrap{ padding:18px 18px 0 18px; }
  .reader-inner{
    width:684px; height:684px; margin:0 auto;
    background:linear-gradient(180deg,#fafafa,#fbfbfb);
    border-radius:10px;
    box-shadow: inset 0 2px 6px rgba(0,0,0,0.06);
    border: 1px solid rgba(0,0,0,0.06);
    position:relative;
  }

  /* Player SVG occupies this area */
  #playerSVG{ width:100%; height:100%; display:block; pointer-events:auto; }

  /* Bottom foot with controls (integrated white footer) */
  .footer {
    height:120px;
    display:flex;
    align-items:center;
    justify-content:space-between;
    padding:18px;
    box-sizing:border-box;
    border-top:1px solid rgba(0,0,0,0.06);
    border-bottom-left-radius:12px;
    border-bottom-right-radius:12px;
    background:var(--panel);
  }

  /* left area for power + indicator */
  .left-controls{ display:flex; align-items:center; gap:16px; padding-left:6px; }

  .power-indicator{
    width:8px; height:8px; border-radius:50%; background:#dff6df; margin-top:-6px; box-shadow:0 0 0 3px rgba(110,227,123,0.05);
  }

  .power-button{
    width:48px; height:48px; border-radius:999px;
    display:flex; align-items:center; justify-content:center;
    background:transparent;
    border:2px solid rgba(0,0,0,0.12);
    box-shadow: 0 3px 8px rgba(0,0,0,0.06);
    cursor:pointer;
    transition: transform 120ms ease;
  }
  .power-button:active{ transform:scale(0.9); }
  .power-button svg{ width:28px; height:28px; }

  /* right area - small circular controls */
  .right-controls{ display:flex; align-items:center; gap:26px; padding-right:10px; }
  .ctrl-btn{
    width:48px; height:48px; border-radius:999px;
    background:transparent; border:2px solid rgba(0,0,0,0.12);
    display:flex; align-items:center; justify-content:center;
    box-shadow: 0 3px 8px rgba(0,0,0,0.06);
    cursor:pointer; transition: transform 120ms ease;
  }
  .ctrl-btn:active{ transform:scale(0.9); }
  .ctrl-btn svg{ width:22px; height:22px; }

  /* tokens (right column not used here) */
  .tokens-grid{ position:relative; width:320px; height:420px; }

  /* cassettes */
  .cassette{ position:absolute; width:200px; height:199px; cursor:grab; user-select:none; touch-action:none; transition: transform .12s, box-shadow .12s, outline .12s; background:transparent; }
  .cassette.dragging{ cursor:grabbing; transform:scale(1.02); }

  /* remove rect backgrounds inside cassette svg */
  .cassette svg rect { display:none !important; }

  /* subtle outlines when playing */
  .cassette.playing{ outline:4px solid rgba(40,200,220,0.95); box-shadow:0 30px 60px rgba(30,160,220,0.08); }
  .cassette.queued{ outline:2px dashed rgba(200,200,200,0.12); box-shadow:0 10px 24px rgba(0,0,0,0.06); }

  /* no browser focus rings for player or controls */
  #playerSVG, #playerSVG * { outline: none !important; -webkit-tap-highlight-color: transparent; }
  .power-button:focus, .ctrl-btn:focus { outline:none; box-shadow:0 0 0 6px rgba(0,0,0,0.03); }

  /* Small helpers */
  .title{ color:#8b8b8b; font-size:14px; margin:8px 0 10px 6px; }
  .center-row{ display:flex; align-items:center; justify-content:center; gap:6px; }

  @media (max-width:800px){
    .stage{ width:94%; }
    .player-card{ width:100%; }
    .reader-inner{ width:88vw; height:88vw; }
  }
</style>
</head>
<body>
  <div class="page">
    <div class="title">The cube digital prototype 1</div>
    <div class="stage">
      <div class="player-card" role="application" aria-label="The CUBE player">
        <div class="reader-wrap">
          <div class="reader-inner" id="readerInner">
            <!-- PLAYER SVG (utan inbyggda knappar) - behålls exakt -->
            <svg id="playerSVG" tabindex="-1" xmlns="http://www.w3.org/2000/svg" width="552" height="673" viewBox="0 0 552 673" preserveAspectRatio="xMidYMid meet">
  <defs>
    <filter id="Rectangle_3"><feOffset input="SourceAlpha"/><feGaussianBlur stdDeviation="1.5" result="blur"/><feFlood result="color"/><feComposite operator="out" in="SourceGraphic" in2="blur"/><feComposite operator="in" in="color"/><feComposite operator="in" in2="SourceGraphic"/></filter>
    <clipPath id="clip-The_cube_digital_prototype_1_1"><rect width="552" height="673"/></clipPath>
  </defs>
  <g id="The_cube_digital_prototype_1_1" clip-path="url(#clip-The_cube_digital_prototype_1_1)">
    <g id="Playyer_body" transform="translate(2 2)" fill="#fff" stroke="#a8a8a8" stroke-width="1">
      <rect width="547" height="671" rx="12" stroke="none"/>
      <rect x="0.5" y="0.5" width="546" height="670" rx="11.5" fill="none"/>
    </g>
    <g id="REader_pad" transform="translate(-291 -175)">
      <g data-type="innerShadowGroup">
        <rect id="Rectangle_3-2" width="535" height="535" rx="8" transform="translate(299 183)" fill="#f7f7f7" opacity="0.997"/>
        <g transform="matrix(1, 0, 0, 1, 291, 175)" filter="url(#Rectangle_3)">
          <rect id="Rectangle_3-3" width="535" height="535" rx="8" transform="translate(8 8)" fill="#fff" opacity="0.997"/>
        </g>
      </g>
      <g id="Ellipse_21" transform="translate(321 204)" fill="none" stroke="#e5e5e5" stroke-width="1">
        <circle cx="246.5" cy="246.5" r="246.5"/><circle cx="246.5" cy="246.5" r="246" fill="none"/>
      </g>
    </g>
    <text id="Reader_pad-2" transform="translate(26 33)" fill="#707070" font-size="15" font-family="HelveticaNeue, Helvetica Neue"><tspan x="0" y="0">Reader pad</tspan></text>
  </g>
</svg>
          </div>
        </div>

        <!-- footer with controls (integrated white bottom) -->
        <div class="footer" role="toolbar" aria-label="Controls">
          <div class="left-controls">
            <div class="power-indicator" id="powerIndicator" aria-hidden="true"></div>
            <button id="powerBtn" class="power-button" aria-pressed="false" title="Power">
              <!-- small power svg -->
              <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                <circle cx="12" cy="12" r="9" fill="none" stroke="#111" stroke-width="1.2"></circle>
                <path d="M12 7v5" stroke="#111" stroke-width="1.6" stroke-linecap="round" fill="none"></path>
              </svg>
            </button>
          </div>

          <div class="right-controls">
            <button id="shuffleBtn" class="ctrl-btn" title="Shuffle" aria-pressed="false">
              <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                <path d="M3 7h4.5c1.6 0 2.5 0 3.4.5 0 0 1 .6 2.6 2.7" stroke="#111" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
                <path d="M21 7l-3-3v2.2" stroke="#111" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
                <path d="M21 17l-3 3v-2.2" stroke="#111" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
              </svg>
            </button>

            <button id="volDownBtn" class="ctrl-btn" title="Vol-">
              <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                <path d="M5 12h10" stroke="#111" stroke-width="1.6" stroke-linecap="round" fill="none"/>
              </svg>
            </button>

            <button id="volUpBtn" class="ctrl-btn" title="Vol+">
              <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                <path d="M12 5v14" stroke="#111" stroke-width="1.6" stroke-linecap="round" fill="none"/>
                <path d="M5 12h14" stroke="#111" stroke-width="1.6" stroke-linecap="round" fill="none"/>
              </svg>
            </button>
          </div>
        </div>
      </div>

      <!-- tokens grid (not visible in design but used for cassette DOM) -->
      <div style="display:none;">
        <div id="tokensGrid" class="tokens-grid"></div>
      </div>
    </div>
  </div>

<!-- loading badge -->
<div style="display:none" id="loadingBadge" aria-hidden="true"></div>

<script>
/* ============================
   AUDIO FILES
   ============================ */
const AUDIO_FILES = [
  'https://raw.githubusercontent.com/StoneMarble303/THEAUDIOCUBE/main/audio/Armaku_ElektroPunk_Full_Drum_Loop_120_08.wav',
  'https://raw.githubusercontent.com/StoneMarble303/THEAUDIOCUBE/main/audio/Armaku_ElektroPunk_Bass_Loop_11_130_Eb_Min.wav',
  'https://raw.githubusercontent.com/StoneMarble303/THEAUDIOCUBE/main/audio/Armaku_ElektroPunk_Full_Drum_Loop_120_06.wav'
];

const audioEls = AUDIO_FILES.map(()=>null);
async function initAudioSources(){
  for (let i=0;i<AUDIO_FILES.length;i++){
    const url = AUDIO_FILES[i];
    const a = new Audio(); audioEls[i]=a;
    if (!url) continue;
    try{
      const r = await fetch(url);
      if (!r.ok){ console.warn('audio fetch failed', r.status, url); continue; }
      const blob = await r.blob();
      a.src = URL.createObjectURL(blob);
      a.preload='auto';
      a.addEventListener('error', ev=> console.warn('audio error', i+1, ev));
      a.addEventListener('canplay', ()=> console.log('canplay', i+1));
      a.addEventListener('loadedmetadata', ()=> console.log('loadedmetadata', i+1, a.duration));
    }catch(e){
      console.warn('audio init error', e);
      a.src = url; a.preload='auto';
    }
  }
}
initAudioSources();

/* ============================
   Simple playback state & UI wiring
   ============================ */
const powerBtn = document.getElementById('powerBtn');
const shuffleBtn = document.getElementById('shuffleBtn');
const volDownBtn = document.getElementById('volDownBtn');
const volUpBtn = document.getElementById('volUpBtn');
const powerIndicator = document.getElementById('powerIndicator');

let powerOn = false;
let shuffleOn = false;
let masterVolume = 0.9;

function updateIndicator(on){
  powerIndicator.style.background = on ? '#dff6df' : 'transparent';
  if (on) powerIndicator.style.boxShadow = '0 0 0 6px rgba(110,227,123,0.04)'; else powerIndicator.style.boxShadow = 'none';
}

async function unlockAudioOnce(){
  if (window._audioUnlocked) return;
  window._audioUnlocked = true;
  for (let a of audioEls){
    if (!a || !a.src) continue;
    try { await a.play().then(()=>{ a.pause(); a.currentTime=0; }).catch(()=>{}); } catch(e){}
  }
}

powerBtn.addEventListener('click', async ()=>{
  await unlockAudioOnce();
  powerOn = !powerOn;
  powerBtn.setAttribute('aria-pressed', String(powerOn));
  updateIndicator(powerOn);
  if (!powerOn){
    audioEls.forEach(a=>{ try{ a.pause(); a.currentTime=0; }catch(e){} });
  }
});
shuffleBtn.addEventListener('click', ()=>{ shuffleOn = !shuffleOn; shuffleBtn.setAttribute('aria-pressed', String(shuffleOn)); shuffleBtn.style.boxShadow = shuffleOn ? '0 6px 20px rgba(0,0,0,0.12)' : '0 3px 8px rgba(0,0,0,0.06)'; });
volDownBtn.addEventListener('click', ()=>{ masterVolume = Math.max(0, masterVolume-0.06); audioEls.forEach(a=>{ if (a) a.volume = masterVolume; }); });
volUpBtn.addEventListener('click', ()=>{ masterVolume = Math.min(1, masterVolume+0.06); audioEls.forEach(a=>{ if (a) a.volume = masterVolume; }); });

/* ============================
   Cassette logic (same as tidigare prototyp)
   - cassettes är dolda i DOM i denna layout, men funktionen finns
   ============================ */
const tokensGrid = document.getElementById('tokensGrid');
const CASSETTE_SVG = `<svg xmlns="http://www.w3.org/2000/svg" width="200" height="199" viewBox="0 0 200 199">
  <defs><clipPath id="clip-cassette"><rect width="200" height="199"/></clipPath></defs>
  <g id="cassette" clip-path="url(#clip-cassette)">
    <g id="Cassestte" transform="translate(-944 -138)">
      <g id="Ellipse_23" transform="translate(948 142)" fill="#dbe1e8" stroke="#707070" stroke-width="1">
        <circle cx="96.5" cy="96.5" r="96.5"/><circle cx="96.5" cy="96.5" r="96" fill="none"/>
      </g>
      <g id="Ellipse_22" transform="translate(956 150)" fill="#dbe1e8" stroke="#707070" stroke-width="1" opacity="0.188">
        <circle cx="88.5" cy="88.5" r="88.5"/><circle cx="88.5" cy="88.5" r="88" fill="none"/>
      </g>
      <g id="Ellipse_3" transform="translate(1035 229)" fill="#ebebeb" stroke="#707070" stroke-width="1">
        <circle cx="9.5" cy="9.5" r="9.5"/><circle cx="9.5" cy="9.5" r="9" fill="none"/>
      </g>
      <text id="Track_1" transform="translate(1015 286)" fill="#707070" font-size="20" font-family="HelveticaNeue, Helvetica Neue"><tspan x="0" y="0">Track 1</tspan></text>
    </g>
  </g>
</svg>`;

let cassetteState = {}, playQueue = [], currentPlayingId = null;

function createCassette(id, idx){
  const wrapper = document.createElement('div');
  wrapper.className = 'cassette';
  wrapper.dataset.cid = id;
  wrapper.dataset.track = idx;
  wrapper.style.left = '10px';
  wrapper.style.top = '6px';
  wrapper.innerHTML = CASSETTE_SVG;
  // hide large rects if any
  try {
    const svg = wrapper.querySelector('svg');
    if (svg) { svg.querySelectorAll('rect').forEach(r=>r.remove()); }
  } catch(e){}
  tokensGrid.appendChild(wrapper);
  cassetteState[id] = { trackIndex: idx, el: wrapper, onPad:false, cached:false, playing:false, queued:false };
  // draggable not shown in UI but kept for prototyping
}

for (let i=0;i<3;i++) createCassette('cass'+(i+1), i);

/* initial UI */
updateIndicator(false);
console.log('Visuell layout: klar. Knappar i bottenpanel, inget fokus-ring, inga stora skuggor.');

</script>
</body>
</html>
